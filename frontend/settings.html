<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>Storyteller | è®¾ç½®</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="assets/css/style.css">
<script>
    (function() {
      // 1. è¯»å–æœ¬åœ°å­˜å‚¨çš„ä¸»é¢˜ (å¦‚æœæ²¡æœ‰åˆ™é»˜è®¤ dark)
      const savedTheme = localStorage.getItem('app_theme') || 'dark';
      const savedBg = localStorage.getItem('app_bg') || 'grid';

      // 2. ç«‹å³åº”ç”¨åˆ° html æ ‡ç­¾ (æ§åˆ¶é¢œè‰²å˜é‡)
      document.documentElement.setAttribute('data-theme', savedTheme);

      // 3. åº”ç”¨èƒŒæ™¯çº¹ç† (æ§åˆ¶ body class)
      // æ³¨æ„ï¼šè¿™é‡Œéœ€è¦ç­‰å¾… DOM è§£æï¼Œæˆ–è€…ç›´æ¥æ“ä½œ document.write (ä¸æ¨è)
      // æœ€ç¨³å¦¥çš„æ–¹å¼æ˜¯ç›‘å¬ DOMContentLoadedï¼Œæˆ–è€…æ”¾åœ¨ body å¼€å§‹æ ‡ç­¾åã€‚
      // ä½†ä¸ºäº†é˜²æ­¢é—ªçƒï¼Œæˆ‘ä»¬å°è¯•ç›´æ¥åœ¨ head é‡Œé¢„è®¾ä¸€ä¸ª style
      window.addEventListener('DOMContentLoaded', () => {
         // æ¸…é™¤æ‰€æœ‰æ—§çš„ bg- å¼€å¤´çš„ç±»
         document.body.className = document.body.className.replace(/\bbg-\S+/g, '').trim();
         // æ·»åŠ æ–°çš„èƒŒæ™¯ç±»
         document.body.classList.add('bg-' + savedBg);
      });
    })();
  </script>
  <style>
    /* å†…è”è¡¥å……æ ·å¼ï¼Œç”¨äºä¸»é¢˜é¢œè‰²é¢„è§ˆå— */
    .preview-dark { background: #05060a; }
    .preview-light { background: #f0f2f5; }
    .preview-cyberpunk { background: linear-gradient(135deg, #000 0%, #0a0a0e 100%); border: 1px solid #0ff; }
    .preview-scroll { background: #e6dcc3; }
    .preview-forest { background: #0b1410; }
    .preview-abyss { background: #0a0000; border: 1px solid #f00; }
    .preview-royal { background: #120a21; border: 1px solid #ffd700; }

    .preview-bg-grid { background-image: linear-gradient(#333 1px, transparent 1px), linear-gradient(90deg, #333 1px, transparent 1px); background-size: 10px 10px; }
    .preview-bg-noise { background-color: #222; opacity: 0.8; }
    .preview-bg-plain { background-color: #222; }
    .preview-bg-runes { background: radial-gradient(circle, #444 0%, #222 100%); }
    .preview-bg-circuit { background-image: radial-gradient(#444 20%, transparent 20%); background-size: 5px 5px; }
  </style>
</head>
<body data-page="settings"> <header class="top-nav">
    <div class="nav-left">
      <span class="app-title">Storyteller</span>
      <span class="app-subtitle">è¯´ä¹¦äººÂ·è®¾ç½®</span>
    </div>
    <nav class="nav-links">
      <a href="index.html" class="nav-link">å‰§æƒ…</a>
      <a href="characters.html" class="nav-link">è§’è‰²</a>
      <a href="worldbook.html" class="nav-link">ä¸–ç•Œä¹¦</a>
      <a href="dungeon.html" class="nav-link">å‰¯æœ¬</a>
      <a href="settings.html" class="nav-link active">è®¾ç½®</a>
    </nav>
  </header>

  <main class="settings-container">

    <aside class="settings-sidebar">
      <button class="settings-tab-btn active" data-target="tab-ui">
        <span class="icon">ğŸ¨</span> ç•Œé¢ä¸æ˜¾ç¤º
      </button>
      <button class="settings-tab-btn" data-target="tab-memory">
        <span class="icon">ğŸ§ </span> æ‘˜è¦ä¸è®°å¿†
      </button>
      <button class="settings-tab-btn" data-target="tab-alignment">
        <span class="icon">âš–ï¸</span> å˜é‡ä¸å¯¹é½
      </button>
      <button class="settings-tab-btn" data-target="tab-evolution">
        <span class="icon">ğŸŒ</span> æ­£æ–‡ä¸æ¼”åŒ–
      </button>
      <button class="settings-tab-btn" data-target="tab-models">
        <span class="icon">ğŸ”—</span> å…¨å±€æ¨¡å‹ç»‘å®š
      </button>
    </aside>

    <section class="settings-content-area">

      <div class="settings-header-actions">
        <span id="settings-status" class="small-text muted">å°±ç»ª</span>
        <button id="settings-load-btn" class="btn-secondary btn-small">é‡ç½®/åŠ è½½</button>
        <button id="settings-save-btn" class="btn-primary btn-small">ä¿å­˜æ‰€æœ‰æ›´æ”¹</button>
      </div>

      <div id="tab-ui" class="tab-pane active">
        <h2 class="section-title">ä¸»é¢˜é£æ ¼ (Theme)</h2>
        <div class="visual-grid" id="theme-grid">
          <div class="visual-option" data-value="dark">
            <div class="color-preview preview-dark"></div>
            <div class="option-label">æ·±ç©º (é»˜è®¤)</div>
          </div>
          <div class="visual-option" data-value="light">
            <div class="color-preview preview-light"></div>
            <div class="option-label">æ™¨æ›¦</div>
          </div>
          <div class="visual-option" data-value="cyberpunk">
            <div class="color-preview preview-cyberpunk"></div>
            <div class="option-label">èµ›åšéœ“è™¹</div>
          </div>
          <div class="visual-option" data-value="scroll">
            <div class="color-preview preview-scroll"></div>
            <div class="option-label">ç¾Šçš®å·</div>
          </div>
          <div class="visual-option" data-value="forest">
            <div class="color-preview preview-forest"></div>
            <div class="option-label">è¿·é›¾æ£®æ—</div>
          </div>
          <div class="visual-option" data-value="abyss">
            <div class="color-preview preview-abyss"></div>
            <div class="option-label">çŒ©çº¢æ·±æ¸Š</div>
          </div>
          <div class="visual-option" data-value="royal">
            <div class="color-preview preview-royal"></div>
            <div class="option-label">çš‡å®¶ç´«é‡‘</div>
          </div>
        </div>

        <h2 class="section-title">èƒŒæ™¯çº¹ç† (Background)</h2>
        <div class="visual-grid" id="bg-grid">
          <div class="visual-option" data-value="grid">
            <div class="color-preview preview-bg-grid"></div>
            <div class="option-label">å…¨æ¯ç½‘æ ¼</div>
          </div>
          <div class="visual-option" data-value="noise">
            <div class="color-preview preview-bg-noise"></div>
            <div class="option-label">èƒ¶ç‰‡å™ªç‚¹</div>
          </div>
          <div class="visual-option" data-value="plain">
            <div class="color-preview preview-bg-plain"></div>
            <div class="option-label">çº¯å‡€è™šç©º</div>
          </div>
          <div class="visual-option" data-value="runes">
            <div class="color-preview preview-bg-runes"></div>
            <div class="option-label">é­”æ³•åŠ›åœº</div>
          </div>
          <div class="visual-option" data-value="circuit">
            <div class="color-preview preview-bg-circuit"></div>
            <div class="option-label">é›†æˆç”µè·¯</div>
          </div>
        </div>

        <div class="settings-section">
            <label class="form-label">åå¤„ç†æ­£åˆ™è§„åˆ™ (JSON)</label>
            <textarea id="postprocessing-rules" class="form-textarea" rows="4"
              placeholder='æ¸…æ´—æ­£æ–‡å†…å®¹çš„æ­£åˆ™ï¼Œä¾‹å¦‚ï¼š[{"pattern": "...", "replacement": ""}]'></textarea>
            <div class="small-text muted" style="margin-top:4px">ç”¨äºåœ¨æ˜¾ç¤ºå‰æ¸…ç† LLM è¾“å‡ºçš„å¤šä½™ç¬¦å·ã€‚</div>
        </div>
      </div>

      <div id="tab-memory" class="tab-pane">
        <h2 class="section-title">è‡ªåŠ¨æ‘˜è¦ä¸ RAG</h2>
        <div class="settings-section">
          <label class="form-check">
            <input type="checkbox" id="summary-enabled">
            <span>å¯ç”¨è‡ªåŠ¨å‰§æƒ…æ‘˜è¦</span>
          </label>
          <div class="small-text muted" style="margin-left: 22px;">ç³»ç»Ÿå°†åœ¨è¾¾åˆ°ä¸€å®šå­—æ•°åè‡ªåŠ¨è°ƒç”¨ LLM æ€»ç»“å‰§æƒ…ã€‚</div>
        </div>

        <div class="half-grid">
            <div class="settings-section">
                <label class="form-label">æ‘˜è¦ Profile ID</label>
                <input id="summary-profile-id" class="form-input" placeholder="å¦‚ï¼šsummary_v1">
            </div>
            <div class="settings-section">
                <label class="form-label">è§¦å‘é¢‘ç‡ (æ¯ N æ®µå¯¹è¯)</label>
                <input id="summary-frequency" class="form-input" type="number" min="1" value="1">
            </div>
        </div>

        <div class="settings-section">
          <label class="form-label">å†å²è®°å¿†æ£€ç´¢ç­–ç•¥ (RAG Config JSON)</label>
          <textarea id="summary-rag-config" class="form-textarea" rows="6" placeholder='ä¾‹å¦‚ï¼š
              {
                "scene_top_k": 3,
                "chapter_top_k": 1,
                "use_raw_segments": true
              }'></textarea>
        </div>
      </div>

      <div id="tab-alignment" class="tab-pane">
        <h2 class="section-title">æ•°å€¼æ€è€ƒä¸æ•°æ®ä¸€è‡´æ€§</h2>
        <div class="settings-section">
            <label class="form-check">
              <input type="checkbox" id="variables-enabled">
              <span>å¯ç”¨å˜é‡è¿½è¸ª (Variable Tracking)</span>
            </label>
        </div>

        <div class="half-grid">
            <div class="settings-section">
                <label class="form-label">å˜é‡æ€è€ƒ Profile ID</label>
                <input id="variables-profile-id" class="form-input" placeholder="ç”¨äºåˆ†ææ•°å€¼å˜åŒ–çš„ Prompt">
            </div>
            <div class="settings-section">
                <label class="form-label">ç‹¬ç«‹ API Config ID</label>
                <input id="variables-api-config-id" class="form-input" placeholder="å»ºè®®ä½¿ç”¨å»‰ä»·é«˜é€Ÿæ¨¡å‹">
            </div>
        </div>

        <div class="settings-section" style="margin-top: 20px; border-top: 1px solid var(--border-soft); padding-top: 15px;">
            <label class="form-check">
              <input type="checkbox" id="alignment-strict">
              <span>å¯ç”¨ä¸¥æ ¼å¯¹é½æ£€æŸ¥ (Strict Alignment)</span>
            </label>
            <div class="small-text muted" style="margin-left: 22px;">é˜²æ­¢ç”Ÿæˆçš„æ•°å€¼è¶…å‡ºè§’è‰²æ¨¡æ¿å®šä¹‰çš„èŒƒå›´ã€‚</div>
        </div>
        <div class="settings-section">
            <label class="form-label">å¯¹é½è§„åˆ™ ID</label>
            <input id="alignment-rule-id" class="form-input" placeholder="å¦‚ï¼šdefault_alignment">
        </div>
      </div>

      <div id="tab-evolution" class="tab-pane">
        <h2 class="section-title">æ–‡æœ¬ä¼˜åŒ–ä¸ä¸–ç•Œæ¼”åŒ–</h2>

        <div class="settings-section">
            <label class="form-check">
              <input type="checkbox" id="textopt-enabled">
              <span>å¯ç”¨æ–‡ç¬”æ¶¦è‰² (Text Polishing)</span>
            </label>
            <div class="settings-section" style="margin-top:8px">
                <label class="form-label">æ¶¦è‰² Profile ID</label>
                <input id="textopt-profile-id" class="form-input" placeholder="å¦‚ï¼štext_opt_v1">
            </div>
        </div>

        <div class="settings-section" style="margin-top: 20px;">
            <label class="form-check">
              <input type="checkbox" id="world-evolution-enabled">
              <span>å¯ç”¨ä¸–ç•ŒåŠ¨æ€æ¼”åŒ– (World Evolution)</span>
            </label>
            <div class="small-text muted" style="margin-left: 22px;">å…è®¸ NPC åœ¨ç©å®¶ä¸åœ¨åœºæ—¶æ ¹æ®ä¸–ç•Œä¹¦è§„åˆ™å‘ç”ŸçŠ¶æ€å˜æ›´ã€‚</div>
            <div class="settings-section" style="margin-top:8px">
                <label class="form-label">æ¼”åŒ–é€»è¾‘ Profile ID</label>
                <input id="world-evolution-profile-id" class="form-input" placeholder="å¦‚ï¼šworld_evolution_v1">
            </div>
        </div>
      </div>

      <div id="tab-models" class="tab-pane">
        <h2 class="section-title">é»˜è®¤ Profile æ˜ å°„</h2>
        <div class="settings-section">
            <div class="small-text muted" style="margin-bottom: 8px;">
                æ­¤å¤„å®šä¹‰ç³»ç»Ÿå„æ¨¡å—é»˜è®¤è°ƒç”¨çš„ Prompt/Model é…ç½®ã€‚
            </div>
            <label class="form-label">Global Default Profiles (JSON)</label>
            <textarea id="default-profiles" class="form-textarea" rows="12" placeholder='{
                "story_generation": "story_gen_v2",
                "npc_chat": "npc_chat_standard",
                "dungeon_master": "dm_hardcore",
                "summary": "summary_fast",
                "variable_thinking": "math_solver"
              }'></textarea>
        </div>
      </div>

    </section>
  </main>

  <script src="assets/js/settings.js"></script>
</body>
</html>